<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
<title>LR(1) Parser Generator</title>
<style>
body { background-color: #F0F0F0; }
body * { font-family:courier; }
td { horizontal-align: middle; vertical-align: top; white-space: nowrap; }
th { white-space: nowrap; }
</style>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/underscore.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/tools.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/grammar.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/grammarview.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/lr1item.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/lrclosuretable.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/lrclosuretableview.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/tree.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/treeview.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/lrtable.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/lrtableview.js"></script>
<script language="javascript" src="LR(1)%20Parser%20Generator_files/lrparseview.js"></script>
</head>
<body>
<script language="javascript">


var lrTable;

function grammarChanged() {
	displayRuleIndices();
	
	//var grammar = new Grammar($element('grammar').value);
	var lrClosureTable = new LRClosureTable(grammar);
	lrTable = new LRTable(lrClosureTable);

	$element('firstFollowView').innerHTML = formatFirstFollow(grammar);
	$element('lrClosureTableView').innerHTML = formatLRClosureTable(lrClosureTable);
	$element('lrTableView').innerHTML = formatLRTable(lrTable);
	
	parseInput();
}

function therunner() {
	var parainput = $element('parainput').value;
	var url = new URL('http://localhost:3000/')
	var clusterResult, posResult;
	var params = {input: parainput};
	var sentences = parainput.split(".");
	
	url.search = new URLSearchParams(params).toString();
	
	const request = async() => {
		await fetch(url).then(data => {
			return data.json();
		}).then(res => {
			clusterResult = res["cluster"];
			posResult = res["pos"];
		}).catch(error => {console.log(error)});
		
		posResult = posResult[1];
		clusterResult = clusterResult[1];

		posResult = posResult.toLowerCase();
		parainput = posResult;
		console.log(clusterResult);
		$element('cluster').value = clusterResult;

		var str = "";
		var i = 0;
		var parseResult = "";
		/*while(i < parainput.length) {
			if(parainput[i] != '.') {
				str += parainput[i];
			}
			else  {
				$element('input').value = str;
				parseResult += str + " ";
				str = "";
				grammarChanged();
				var result = parseInput();
				if(result == 0)
					parseResult += "not acccepted\n";
				else	
					parseResult += "accepted\n" 
			}
			i++;
		}
		console.log(parseResult);*/
		parainput = parainput.split(".");
		for(var i = 0; i < parainput.length ; i++) {
			if(parainput[i] == " " || parainput[i] == "\n")
				continue;
			$element('input').value = parainput[i];
			parseResult += sentences[i] + " ";
			grammarChanged();
			var result = parseInput();
			if(result == 0)
				parseResult += "not acccepted\n";
			else	
				parseResult += "accepted\n" 
		}
		console.log(parseResult);
		$element('correctness').value = parseResult;
	};

	request();
	
	
	
}

</script>
<table><tbody><tr>
	<td>
	<div id="grammarView" hidden>
	</div>
	<br>
	<div id ='firstFollowView' hidden></div>
	<div style="height: 100%; overflow: auto;">
		<div id="lrClosureTableView"hidden></div>
		<div id="lrTableView" hidden></div>
	</td>
	<td> 
			<div id="lrParseView">
			</div>
			<textarea id='acc-state'></textarea>
			<textarea id='parainput' rows='7' cols='30'></textarea>
			<button onclick="therunner()">RUNNER</button><br>
			<textarea id='cluster' rows='12' cols='40'></textarea>
			<textarea id='correctness' rows='12' cols='40'></textarea>
	</td></tr></tbody></table>
	</div>
</td></tr>
</tbody></table>


<script language="javascript">
{
	var grammar = new Grammar('S\' -> S\n\
S -> N V \n\
N -> d n\n\
N -> d ad n\n\
N -> p n\n\
N -> p\n\
N -> n\n\
V -> v\n\
V -> v j\n\
V -> v v\n\
V -> v a v');

	$element('grammarView').innerHTML = formatGrammar(grammar);
}

$element('lrParseView').innerHTML = formatInitialParseView('', 100);

</script>
</body></html>